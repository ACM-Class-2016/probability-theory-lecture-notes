\input{def.tex}

\title{Lecture Notes for Probability Theory --- Class 8}
\author{Ding Yaoyao}
\date{}

\begin{document}
\lstset{numbers=left,
	basicstyle=\scriptsize\courier,
	numberstyle=\tiny\courier\color{red!89!green!36!blue!36},
	language=C++,
	breaklines=true,
	keywordstyle=\color{blue!70},commentstyle=\color{red!50!green!50!blue!50},
	morekeywords={},
	stringstyle=\color{purple},
	frame=shadowbox,
	rulesepcolor=\color{red!20!green!20!blue!20}
}
\maketitle
\tableofcontents

\newpage

\section{马尔可夫链}
	\subsection{引入}
		在一个随机过程中，有可能未来的状态取决于先前到达过的所有状态，也有可能只取决于当前状态，还有可能与这些状态都无关，而马尔可夫链描述的随机过程就是指未来的状态只取决于当前的状态，而与如何到达这种状态的过程无关的随机过程．
	\subsection{定义}
		可以用多种方式去描述马尔可夫链：
		\subsubsection{定义一} 
		马尔可夫链是一列随机变量：
		$$
			(X_0, X_1, X_2, \dots)
		$$
		且满足
		$$
			P(X_{t+1}=x_{t+1} \mid X_0=x_0,\dots,X_t=x_t) = P^{(t+1)}(X_{t+1}=x_{t+1}\mid X_t=x_t)
		$$
		\subsubsection{定义二}
		假设存在一个状态空间$\cal S$，在其上有一个初始分布$\mu$，并且存在一个概率矩阵\footnote{也可叫做转移矩阵或随机矩阵}序列
		$P^{(1)}, P^{(2)}, \dots, P^{(n)}, \dots$，那么我们可以定义由它们导出的马尔可夫链为${\cal S}^{\mathbb{N}}$上的一个概率测度，并且满足如下性质：
		$$
			P(\{w \mid w_0=i_0,\dots,w_n=i_n \}) = \mu(i_0)P_{i_0i_1}^{(1)}\dots P_{i_{n-1}i_n}^{(n)}, \quad \quad \forall  w \in {\cal S}^{n+1}, \forall n \in \mathbb{N}
		$$
		其中$P_{ij}^{k}$表示第$k$个概率矩阵的第$i$行$j$列那一项，$i$为$\cal S$中的元素．
		
		\remark 定义二应该假设了状态空间有限，否则无法定义概率矩阵，当然如果把${\cal S}\times {\cal S} \rightarrow [0,1]$看作是一个无限情况下的概率矩阵，那么就没有这个问题，概率矩阵应该满足每一行非负且和为$1$．
		
		\subsubsection{定义三}
		对于一个有向图图$G = (V,E)$，边有边权，且边权为正实数，还满足每个点的所有出边的权值和为$1$，再加上一个图上的初始分布$\mu$，我们就定义了一个马尔可夫链$(G,\mu)$。
		
		\remark 定义三假设了这是一个齐次的马尔可夫链，非齐次马尔可夫链对应的应该是一个层次图，图$G_n$的点的出边指向图$G_{n+1}$。
		
	\subsection{齐次马尔可夫链}
		在以上的两个定义中，我们可以发现，虽然某个状态转移到下一个状态的概率不与以前的状态有关，但还和当前处于第几个步骤有关．如果我们把后者去掉，即状态的转移与步骤数无关的话，我们就称这种特殊的马尔可夫链为齐次马尔可夫链，此时转移矩阵满足：
		$$
			P^{(1)} = P^{(2)} = \cdots = P^{(n)} = \cdots 
		$$
	\subsection{Chapman–Kolmogorov equation}
		对于一个马尔可夫链，我们用$P_{t}^{(n)}(i,j)$表示，第$t$时刻状态是$i$，经过$n$次转移后，转移到$j$的概率，那么有：
		$$
			P_{t}^{(n+m)}(i,j) = \sum_{k \in \cal S}P_{t}^{(n)}(i,k)P_{t+n}^{(m)}(k,j)
		$$
		
		\remark 我一开始想，这东西不是全概率公式的直接推广吗，马尔可夫条件在这里有什么用呢？后来发现，如果没有马尔可夫条件，我们定义的$P_{t}^{(n)}(i,j)$是没有意义的，比如第$t+1$步的分布不仅仅需要第$t$步所在的状态，还需要以前的状态，那么我们就无法定义$P_{t}^{(n)}(i,j)$，因为对于$t$步之前的不同状态，这个值可能不同。
		
\section{例子} 
		\subsection{例一：赌徒破产问题（Gamble's Ruin）}
		一个赌徒和赌场赌钱，假设一开始赌场有$A$元钱，赌徒有$B$元钱，每次抛一枚硬币，如果是正面，赌徒从赌场手中得到一元钱，否则赌徒给赌场一元钱，赌场或赌徒某一方钱输光时，赌博结束．
		
		我们分析一下这个问题，假设我们用$X_i$表示抛完$i$次硬币后，赌徒手中的钱减去他一开始的钱，显然有$X_0 = 0$．然后我们发现，第$i+1$次抛完硬币后的钱数$X_{i+1}$的只取决于第$i$次抛完硬币后的钱数$X_i$，而与前$i-1$次的情况无关，所以这是一个马尔可夫链。
		
		\remark 有兴趣的同学可以推一下赌徒破产的概率($\frac{A}{A+B}$)，所以如果赌徒的钱没有赌场多，和赌场玩这个游戏，赌徒破产的概率高于赌场，如果赌场的钱是赌徒的几百倍，那么几乎等于赌徒把钱送给赌场。
		
		\subsection{例二：Wright-Fisher model}
		有一个种群，考虑这个物种的一组等位基因：$A$和$a$，假设种群大小不变，自由交配，且$A\rightarrow a$突变的概率为$u$，$a\rightarrow A$突变的概率为$v$，且$A$和$a$总的个数为$N$，那么我们可以把种群中$A$基因的个数$i$作为状态，经过一次繁殖，$A$基因个数会发生变化，假设从$i$个变到$j$个的概率为$P(i,j)$，那么有：
		$$
			\rho_i = \frac{i}{N}(1-u)+\frac{N-i}{N}v
		$$
		$$
			P(i,j) = \binom{N}{j}\rho_i^j(1-\rho_i)^{N-j}
		$$
		其中$\rho_i$算的是，在种群中$A$个数为$i$的前提下，取一个基因出来，会得到$A$的概率（要考虑基因突变）。这显然是一个马尔可夫链。
		
		\subsection{例三：随机游走}
		金榜最开始在数轴上的$0$的位置。如果金榜当前时刻在$a$，那么下一时刻，他会以$p$的概率出现在$a+1$，以$q$（等于$1-p$）的概率出现在$a-1$。设$X_i$为金榜第$i$个时刻所在的位置，请问$P(X_n = i)$的概率。
		
		\proof 显然$(pe^{i\theta}+qe^{-i\theta})^n$的展开式中，$e^{ji\theta}$的系数是$P(X_n=j)$，所以我们只需要算出这个系数即可。又
		$$
		\frac{1}{2\pi}\int_{-\pi}^{\pi}e^{ji\theta}d\theta = [j = 0]
		$$
		我们可以得到：
		$$
			P(X_n=j) = \frac{1}{2\pi}\int_{-\pi}^{\pi}(pe^{i\theta}+qe^{-i\theta})^ne^{-ji\theta}d\theta
		$$
		我们这里考虑简单的一种情况：$p = q = 0.5$，我们有：$(pe^{i\theta}+qe^{-i\theta})^n = (cos\theta)^n$，然后有\footnote{积分见思考题中的问题二}：
		$$
			P(X_n=j) = \frac{1}{2\pi}\int_{-\pi}^{\pi}(cos\theta)^ne^{-ji\theta}d\theta = \frac{1}{2^{n+1}}[1+(-1)^{n+j}]\binom{n}{\frac{n+j}{2}}
		$$
		
		\remark 这道题还可以用更简单的生成函数解决，即求$(px+qx^{-1})^n$中$x^i$的系数。
		
		\remark 还有更更简单的做法，设一共向右走了$a$步，向左走了$b$步，可以根据$a+b=n,a-b=i$算出$a,b$然后直接得出结果。
		
		\subsection{例四：丢呀丢呀丢硬币}
		金榜在丢硬币玩，他丢了$2n$次硬币，每次等概率地正面反面，问最后一个时刻满足到这个时刻为止正面数等于反面数的概率分布。
		
		\proof 令$X_i$表示第$i$次抛硬币的结果，如果正面就是$1$，反面就是$-1$，令$S_i=X_1+X_2+\dots+X_i$，令$T$表示最后一个满足条件的时刻，显然这个时刻一定是偶数，我们有：
		\[ \begin{split}
			P(T=2k) = & P(S_{2k}=0,S_{2k+1}\neq0,\dots,S_{2n}\neq0) \\
					= & P(S_{2k}=0)P(S_{2k+1}\neq0,\dots,S_{2n}\neq0) \\
					= & P(S_{2k}=0)P(S_1\neq0,\dots,S_{2n-2k}\neq0) \\
					= & 2P(S_{2k}=0)P(S_1>0,\dots,S_{2n-2k}>0) \\
					= & 2P(S_{2k}=0)\sum_{r=1}^{\infty}P(S_1>0,\dots,S_{2n-2k-1}>0,S_{2n-2k}=2r) \\
					= & 2P(S_{2k}=0)\sum_{r=1}^{\infty}\frac{N_{2j-1}^{2r-1}-N_{2j-1}^{2r+1}}{2^{2j}}	\quad (let \; j = n-k)\\
					= & P(S_{2k}=0)\frac{N_{2j-1}^{1}}{2^{2j-1}} \\
					= & P(S_{2k}=0)P_{2j-1}^{1} = P_{2k}^{0}P_{2j}^{0} \\
		\end{split}	\]
		其中$N_i^j$表示从$0$开始，抛$i$次，最后得到$j$的方案数，$P_i^j$表示其概率。
		
		上面有一个比较关键的一步：
		$$
		P(S_1>0,\dots,S_{2n-2k-1}>0,S_{2n-2k}=2r) = \frac{N_{2j-1}^{2r-1}-N_{2j-1}^{2r+1}}{2^{2j}}
		$$
		
		我们把抛硬币转化成这样一个模型:我们最开始在$(0,0)$。如果在某次抛硬币之前我们在$(x,y)$，我们抛一次正面，我们走到$(x+1,y+1)$，否则走到$(x+1,y-1)$，然后上面式子的左边就相当于我们第一步必须走到$(1,1)$，然后所有从$(1,1)$到$(2n-2k,2r)$的不经过$(x,0)$这样的点的路径数，而后面这个问题我们可以先算出从$(1,1)$到$(2n-2k,2r)$的所有路径数，然后减去那些不和法的，不合法的路径数等于我们从$(1,-1)$走到$(2n-2k,2r)$的路径数，因为我们可以在这两种路径之间建立一个双射（具体的映射方法为把第一次到达$(x,0)$这个位置的之前的路径上下翻转），所以我们要求的方案数就是$N_{2j-1}^{2r-1}-N_{2j-1}^{2r+1}$。
		
		\subsection{例五：Ehrenfest chain(urn)}
		我们有一个大小为$n$集合，并且这个集合可以分成两类：$A, B$，每次我们都随机从整个大的集合中选择一个点，然后将它放到另外一类中去。
		
		我们可以发现，上面这个随机过程是一个马尔可夫链，我们如果用一个列向量$x$表示一开始的概率分布（即$x_i = P(\lvert A\rvert=i)$），然后转移矩阵$A$是比较显然的：
		$$
			A_{i,i+1} = \frac{i+1}{n}
		$$
		$$
			A_{i,i-1} = \frac{n-i+1}{n}
		$$
		其它的位置都是$0$。
		进行$k$步操作之后的概率分布为：$A^kx$。我们很想知道是否存在一个稳定状态$x_0$，即满足：
		$$
			Ax_0 = x_0
		$$
		显然，我们可以暴力解这个方程：
		$$
			(A-I)x_0 = 0
		$$
		但我们也可以通过概率方法直接得出结论：
		$$
			x_i = \frac{1}{2^n} \binom{n}{i}
		$$
		$x_i$的意义是抛$n$次硬币，一共有$i$次朝上的概率，而$(Ax)_i$的意义是抛$n$次硬币，然后随机选一个硬币把它的结果反转，不论选的是把哪个硬币反转，其结果的分布都是和$x$一致，所以总的分布也和$x$一致，即$Ax=x$。
\section{思考题}
	\subsection{问题一}
		假设$X_i$为一个马尔可夫链，给定一个$f$，显然$f(X_i)$是一个随机变量序列，请分析$f(X_i)$是否为马尔可夫链。

	\subsection{问题二}
		请证明：
		$$
		\frac{1}{2\pi}\int_{-\pi}^{\pi}(cos\theta)^ne^{-ji\theta}d\theta = \frac{1}{2^{n+1}}[1+(-1)^{n+j}]\binom{n}{\frac{n+j}{2}}
		$$
	\subsection{问题三：自由飞翔}
		一只蚊子在飞翔，最开始它在$(0,0)$，然后每个时刻，它会选择一个方向（$1,w,w^2$，其中$w$是三次单位根，且三个方向概率相等）然后飞去，总共飞$N$步，设$T$是它最后一次飞到原点的时刻，那么$P(T=t)$是多少呢($0\leq t \leq N$)？
		
		然而蚊子是渴望自由的，所以如果每个时刻它选择任意一个方向（即等概率地选择单位原上的一点作为向量终点的单位向量）飞去，总共飞$N$步，设$T$是它最后一次飞到原点的时刻，那么$P(T=t)$是多少呢？
		
	\subsection{问题四：Lipsius高度}
		有一个随机过程，一开始金榜在原点，每个时刻他等概率地选择向左或向右走一个单位长度，总共走$n$步，假设$X_0, X_1, \dots, X_n$为他在各个时刻所在的位置，这些数的最大值减去最小值的期望是多大？即：
		$$
			E[max(X_i) - min(X_i)]
		$$
	
	\vspace{2cm}
	以上如有错误请与我联系，谢谢。
	
	邮箱：idy002@163.com
\end{document}　
